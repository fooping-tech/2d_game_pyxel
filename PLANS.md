# 2D縦スクロール・ジャンピングゲーム（pyxel）仕様

このリポジトリは `../2d_game`（pygame版）の仕様を踏襲し、pyxelで再実装したものです。

## ゲームの目的（プレイヤ体験）

- 足場を渡って上方向へ登り続け、最高到達「階層（floor）」を伸ばす。
- 下から水位が迫り、遅いと水没してゲームオーバーになる。
- 敵を踏みつけ撃破すると、シェイク/ヒットストップ/パーティクル/SEで気持ちよさを出す。
- アイテムで短時間の強化（速度/ジャンプ/すり抜け/無敵/最大HP+1）。
- 開始時の“番人”との対話で雰囲気プロンプトを作り、テーマ（配色・形・名称）を変える。

## 操作

- ← / →: 移動
- Space（または Z）: ジャンプ（長押しで貯め、離して発射）
- Enter: 決定
- Esc: 戻る（タイトルでは終了）

## コアゲームループ

1. 入力処理（左右 + ジャンプ貯め/発射）
2. 物理更新（重力、衝突、摩擦、最大速度）
3. カメラ更新（上方向に追従）
4. 生成（足場、アイテム、敵）
5. 判定（アイテム取得、敵との衝突/踏みつけ、無敵/すり抜け）
6. UI（水位、HP、階層）
7. 演出（撃破シェイク/ヒットストップ/パーティクル/SE）
8. ゲームオーバー判定（落下、水没、HP0）

## スコア（階層）

- `floor = int((start_y - min_y) / FLOOR_HEIGHT_PX)` として最高到達を整数化。

## タイムプレッシャー（水位）

- 水位は時間と階層に応じた速度で上昇（画面下→上へ迫る）。
- 水位が近いと警告SE。

## キャラクタ生成（ローディング）

- 番人の入力完了後、ローディングバーを表示しつつキャラクタ外見を生成。
- `GAME_CHARACTER_GENERATE_CMD` があれば外部コマンドで `save/generated_character.json` を生成し、失敗時は決定論フォールバック。

## 永続化

- `save/highscore.json`: ハイスコア
- `save/runs.json`: 直近100件の記録（ランキング用）

